

线程的效率和数据的一致性

  CPU缓存 Java内存模型
  重排序  内存可见性


  Happen-before原则 来描述 内存可见性

单线程

  数据依赖性  as-if-serial
  
 数据竞争  
 
  数据竞争与顺序一致性 
  同步保证 顺序一致性
  
  
  
  锁规则
  volatile变量规则




Java的并发采用的是共享内存模型


同步是指程序中用于控制不同线程间操作发生相对顺序的机制


内存可见性


Java内存模型

  本地内存  内存可见性  写缓冲区

  JMM决定一个线程对共享变量的写入何时对另一个线程可见
  JMM通过控制主内存与每个线程的本地内存之间的交互，来为Java程序员提供内存可见性保证。
  happens-before
  






final







 

# 锁

  锁可以让临界区互斥执行  顺序执行

内存含义



  当线程释放锁时，JMM会把该线程对应的本地内存中的共享变量刷新到主内存中
  线程获取锁时，JMM会把该线程对应的本地内存置为无效。从而使得被监视器保护的临界区代码必须从主内存中读取共享变量

  释放锁的线程。通过主内存向向获取同一个锁的线程发送消息


锁释放-获取的内存语义的实现 和 volatile











